<div class="requests-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>
        <app-back-button></app-back-button>
        <mat-icon>event</mat-icon>
        {{ isAdmin ? 'Booking Requests' : 'My Bookings' }}
      </h1>
      <p class="subtitle">{{ isAdmin ? 'Manage all booking requests' : 'View and track your booking requests' }}</p>
    </div>
    <div class="header-actions">
      <app-button variant="outline" icon="refresh" (clicked)="refreshData()">
        Refresh
      </app-button>
      <app-button variant="primary" icon="add" [routerLink]="['/dashboard/book-room']">
        New Booking
      </app-button>
    </div>
  </div>

  <!-- Filters Bar -->
  <div class="filters-bar">
    <div class="filter-group">
      <button
        *ngFor="let status of ['all', 'Pending', 'Booked', 'Rejected']"
        class="filter-chip"
        [class.active]="statusFilter === status"
        (click)="onStatusFilterChange(status)">
        <span class="chip-label">{{ status === 'all' ? 'All' : status }}</span>
        <span class="chip-count">{{ getFilterCount(status, 'status') }}</span>
      </button>
    </div>

    <div class="filter-divider"></div>

    <div class="filter-group">
      <button
        *ngFor="let time of ['all', 'today', 'upcoming', 'past']"
        class="filter-chip"
        [class.active]="timeFilter === time"
        (click)="onTimeFilterChange(time)">
        <mat-icon>{{ time === 'all' ? 'calendar_month' : time === 'today' ? 'today' : time === 'upcoming' ? 'event' : 'history' }}</mat-icon>
        <span class="chip-label">{{ time === 'all' ? 'All Time' : time === 'today' ? 'Today' : time === 'upcoming' ? 'Upcoming' : 'Past' }}</span>
      </button>
    </div>

    <div class="spacer"></div>

    <div class="search-box">
      <mat-icon>search</mat-icon>
      <input
        type="text"
        placeholder="Search by name, room, or purpose..."
        [(ngModel)]="searchQuery"
        (ngModelChange)="applyFilters()">
    </div>
  </div>

  <!-- Requests Table -->
  <app-card class="table-card">
    <div class="table-container">
      <div *ngIf="loading" class="loading-overlay">
        <mat-spinner diameter="40"></mat-spinner>
      </div>

      <table mat-table [dataSource]="dataSource" matSort class="requests-table">
        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
          <td mat-cell *matCellDef="let request" class="request-id">#{{ request.id }}</td>
        </ng-container>

        <!-- Employee Column -->
        <ng-container matColumnDef="employeeName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Employee</th>
          <td mat-cell *matCellDef="let request">
            <div class="employee-cell">
              <div class="employee-avatar">{{ request.employeeName?.charAt(0).toUpperCase() }}</div>
              <span>{{ request.employeeName }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Room Column -->
        <ng-container matColumnDef="roomName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Room</th>
          <td mat-cell *matCellDef="let request">
            <div class="room-cell">
              <mat-icon>meeting_room</mat-icon>
              <span>{{ request.roomName }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Date Column -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
          <td mat-cell *matCellDef="let request">{{ formatDate(request.date) }}</td>
        </ng-container>

        <!-- Time Column -->
        <ng-container matColumnDef="time">
          <th mat-header-cell *matHeaderCellDef>Time</th>
          <td mat-cell *matCellDef="let request" class="time-cell">
            <mat-icon>schedule</mat-icon>
            <span>{{ formatTime(request.startTime) }} - {{ formatTime(request.endTime) }}</span>
          </td>
        </ng-container>

        <!-- Purpose Column -->
        <ng-container matColumnDef="purpose">
          <th mat-header-cell *matHeaderCellDef>Purpose</th>
          <td mat-cell *matCellDef="let request" class="purpose-cell">
            {{ request.purpose || 'No purpose specified' }}
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
          <td mat-cell *matCellDef="let request">
            <span class="status-badge" [ngClass]="'status-' + getStatusVariant(request.status)">
              {{ request.status }}
            </span>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let request">
            <div class="action-buttons" *ngIf="request.status === 'Pending'">
              <ng-container *ngIf="isAdmin; else employeeActions">
                <button mat-icon-button class="approve-btn" (click)="confirmRequest(request.id)" matTooltip="Approve">
                  <mat-icon>check_circle</mat-icon>
                </button>
                <button mat-icon-button class="reject-btn" (click)="rejectRequest(request.id)" matTooltip="Reject">
                  <mat-icon>cancel</mat-icon>
                </button>
              </ng-container>
              <ng-template #employeeActions>
                <button mat-icon-button class="edit-btn" (click)="editRequest(request.id)" matTooltip="Edit">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button class="delete-btn" (click)="deleteRequest(request.id)" matTooltip="Delete">
                  <mat-icon>delete</mat-icon>
                </button>
              </ng-template>
            </div>
            <span *ngIf="request.status !== 'Pending'" class="no-actions">-</span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        <!-- No Data Row -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell no-data" [attr.colspan]="displayedColumns.length">
            <div class="no-data-message">
              <mat-icon>event_busy</mat-icon>
              <h3>No booking requests found</h3>
              <p>{{ searchQuery ? 'Try adjusting your search or filters' : 'No booking requests match the selected filters' }}</p>
              <app-button variant="primary" icon="add" [routerLink]="['/dashboard/book-room']">
                Create New Booking
              </app-button>
            </div>
          </td>
        </tr>
      </table>

      <mat-paginator 
        [pageSizeOptions]="[10, 25, 50]" 
        [pageSize]="10"
        showFirstLastButtons>
      </mat-paginator>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="loading">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading requests...</p>
    </div>
  </app-card>
</div>

