<div class="profile-container" *ngIf="userProfile">
  <!-- Header -->
  <div class="profile-header">
    <div class="avatar-section">
      <div class="avatar-container">
        <div class="avatar-circle" *ngIf="!getProfileImageUrl()">
          {{ getInitials() }}
        </div>
        <img *ngIf="getProfileImageUrl()" [src]="getProfileImageUrl()" alt="Profile" class="avatar-image">
        <button *ngIf="isEditMode" class="change-photo-btn" type="button" (click)="fileInput.click()">
          <mat-icon>camera_alt</mat-icon>
        </button>
        <input #fileInput type="file" accept="image/*" (change)="onFileSelected($event)" style="display: none;">
      </div>
      <div class="user-info">
        <h1>{{ userProfile.fullName }}</h1>
        <p class="user-role">{{ userProfile.role }}</p>
      </div>
    </div>
    <app-button 
      *ngIf="!isEditMode" 
      variant="primary" 
      icon="edit"
      (clicked)="toggleEdit()">
      Edit Profile
    </app-button>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <app-card class="stat-card">
      <div class="stat-content">
        <mat-icon class="stat-icon">event</mat-icon>
        <div class="stat-info">
          <div class="stat-value">{{ stats.totalBookings }}</div>
          <div class="stat-label">Total Bookings</div>
        </div>
      </div>
    </app-card>

    <app-card class="stat-card">
      <div class="stat-content">
        <mat-icon class="stat-icon upcoming">schedule</mat-icon>
        <div class="stat-info">
          <div class="stat-value">{{ stats.upcomingBookings }}</div>
          <div class="stat-label">Upcoming</div>
        </div>
      </div>
    </app-card>

    <app-card class="stat-card">
      <div class="stat-content">
        <mat-icon class="stat-icon completed">check_circle</mat-icon>
        <div class="stat-info">
          <div class="stat-value">{{ stats.completedBookings }}</div>
          <div class="stat-label">Completed</div>
        </div>
      </div>
    </app-card>

    <app-card class="stat-card">
      <div class="stat-content">
        <mat-icon class="stat-icon pending">pending</mat-icon>
        <div class="stat-info">
          <div class="stat-value">{{ stats.pendingRequests }}</div>
          <div class="stat-label">Pending</div>
        </div>
      </div>
    </app-card>
  </div>

  <!-- Profile Form -->
  <app-card class="profile-form-card">
    <div class="card-header">
      <h2>Personal Information</h2>
    </div>

    <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">
            <mat-icon>person</mat-icon>
            First Name *
          </label>
          <div class="input-wrapper">
            <input type="text" class="form-control" formControlName="firstName">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">
            <mat-icon>person_outline</mat-icon>
            Middle Name
          </label>
          <div class="input-wrapper">
            <input type="text" class="form-control" formControlName="middleName">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">
            <mat-icon>person</mat-icon>
            Last Name *
          </label>
          <div class="input-wrapper">
            <input type="text" class="form-control" formControlName="lastName">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">
            <mat-icon>email</mat-icon>
            Email Address *
          </label>
          <div class="input-wrapper">
            <input type="email" class="form-control" formControlName="email">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">
            <mat-icon>badge</mat-icon>
            Role
          </label>
          <div class="input-wrapper">
            <input type="text" class="form-control" formControlName="role">
          </div>
        </div>
      </div>

      <div class="form-actions" *ngIf="isEditMode">
        <app-button 
          variant="outline" 
          type="button"
          (clicked)="cancelEdit()">
          Cancel
        </app-button>
        <app-button 
          variant="primary" 
          type="submit"
          [loading]="loading"
          [disabled]="profileForm.invalid || loading">
          Save Changes
        </app-button>
      </div>
    </form>
  </app-card>

  <!-- Security Section -->
  <app-card class="security-card">
    <div class="card-header">
      <h2>Security</h2>
    </div>

    <div class="security-content">
      <div class="security-item">
        <div class="security-info">
          <mat-icon>lock</mat-icon>
          <div>
            <div class="security-title">Password</div>
            <div class="security-description">Keep your account secure</div>
          </div>
        </div>
        <app-button variant="outline" (clicked)="changePassword()">
          Change Password
        </app-button>
      </div>
    </div>
  </app-card>
</div>

<div class="loading-container" *ngIf="loading && !userProfile">
  <mat-icon>hourglass_empty</mat-icon>
  <p>Loading profile...</p>
</div>
